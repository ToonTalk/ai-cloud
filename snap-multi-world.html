<html>
<head>
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Snap! Build Your Own Blocks</title>
		<link rel="shortcut icon" href="favicon.ico">
		<script type="text/javascript" src="snap/morphic.js"></script>
		<script type="text/javascript" src="snap/widgets.js"></script>
		<script type="text/javascript" src="snap/blocks.js"></script>
		<script type="text/javascript" src="snap/threads.js"></script>
		<script type="text/javascript" src="snap/objects.js"></script>
		<script type="text/javascript" src="snap/gui.js"></script>
		<script type="text/javascript" src="snap/paint.js"></script>
		<script type="text/javascript" src="snap/lists.js"></script>
		<script type="text/javascript" src="snap/byob.js"></script>
		<script type="text/javascript" src="snap/tables.js"></script>
		<script type="text/javascript" src="snap/symbols.js"></script>
		<script type="text/javascript" src="snap/xml.js"></script>
		<script type="text/javascript" src="snap/store.js"></script>
		<script type="text/javascript" src="snap/locale.js"></script>
		<script type="text/javascript" src="snap/cloud.js"></script>
		<script type="text/javascript" src="snap/sha512.js"></script>
		<script type="text/javascript" src="snap/FileSaver.min.js"></script>
		<script type="text/javascript">
			var worlds;
			window.onload = function () {
				var world_canvases = document.getElementsByClassName("snap-world");
				worlds = Array.prototype.map.call(world_canvases,
				                                  function (world_canvas) {
													   return new WorldMorph(world_canvas);
												  });
//                 world_1.worldCanvas.focus();
//                 world_2.worldCanvas.focus();
                var ide_morphs = worlds.map(function (world) {
                	                            var ide_morph = new IDE_Morph();
                	                            ide_morph.openIn(world);
												return ide_morph;
											});
                Array.prototype.forEach.call(world_canvases,
											 function (world_canvas, index) {
											 	 var project_path = world_canvas.getAttribute('project_path');
											 	 fetch(project_path).then(function (response) {
											 	 	response.text().then(function (project_text) {
											 	 		ide_morphs[index].rawOpenProjectString(project_text);
											 	 	});
											 	 }).catch(function (error) {
											 	 	console.error("Error fetching " + project_path + ": " + error.message);
											 	 });
												 world_canvas.style.position = 'relative';
											 });
                loop();
			};
			function loop() {
                requestAnimationFrame(loop);
                 worlds.forEach(function (world) {
                	world.doOneCycle();
                });
			}
		</script>
	</head>
</head>
<body>
<p>Some text</p>
<canvas id="world_1" class="snap-world" project_path="projects/single-speak-block.xml"></canvas>
<p>And some more.</p>
<canvas id="world_2" class="snap-world" project_path="projects/single doorbell fix.xml"></canvas>
<p>Final text</p>
</body>
</html>
